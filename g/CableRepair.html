<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RÃ©paration des cÃ¢bles - Among Us</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        body {
            background-color: #1a1a2e;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 15px;
            overflow-x: hidden;
        }
        
        .container {
            width: 100%;
            max-width: 100%;
            background-color: #16213e;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            text-align: center;
        }
        
        h1 {
            color: #e94560;
            margin-bottom: 15px;
            font-size: 1.8rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .instructions {
            background-color: #0f3460;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            line-height: 1.5;
            font-size: 0.9rem;
        }
        
        .game-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .cable-column {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }
        
        .cable-column h2 {
            margin-bottom: 12px;
            color: #e94560;
            font-size: 1.2rem;
        }
        
        .cable-row {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 10px;
        }
        
        .cable-socket {
            width: 45%;
            height: 45px;
            background-color: #0f3460;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .cable-socket::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background-color: #1a1a2e;
            border-radius: 50%;
        }
        
        .cable {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s;
            position: relative;
            z-index: 10;
            touch-action: none;
        }
        
        .cable:active {
            transform: scale(1.1);
        }
        
        .cable.red { background-color: #e94560; }
        .cable.blue { background-color: #4e9de6; }
        .cable.green { background-color: #4caf50; }
        .cable.yellow { background-color: #ffeb3b; }
        .cable.purple { background-color: #9c27b0; }
        .cable.orange { background-color: #ff9800; }
        
        .cable-line {
            position: absolute;
            height: 6px;
            background-color: inherit;
            z-index: 5;
            pointer-events: none;
            transform-origin: 0 0;
        }
        
        .message {
            margin-top: 15px;
            padding: 12px;
            border-radius: 6px;
            font-weight: bold;
            display: none;
            font-size: 0.9rem;
        }
        
        .message.success {
            background-color: rgba(76, 175, 80, 0.3);
            color: #4caf50;
            display: block;
        }
        
        .message.error {
            background-color: rgba(233, 69, 96, 0.3);
            color: #e94560;
            display: block;
        }

        @media (min-width: 768px) {
            .container {
                max-width: 500px;
            }
            
            .game-area {
                flex-direction: row;
            }
            
            .cable-column {
                width: 48%;
            }
            
            .cable-row {
                flex-direction: column;
            }
            
            .cable-socket {
                width: 100%;
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>RÃ©paration des cÃ¢bles</h1>
        
        <div class="instructions">
            <p>ðŸ‘† Touchez et maintenez un cÃ¢ble, puis glissez-le vers le connecteur de mÃªme couleur</p>
        </div>
        
        <div class="game-area">
            <div class="cable-column" id="left-column">
                <h2>CÃ¢bles</h2>
                <div class="cable-row" id="left-cables">
                    <!-- Les cÃ¢bles seront gÃ©nÃ©rÃ©s par JavaScript -->
                </div>
            </div>
            
            <div class="cable-column" id="right-column">
                <h2>Connecteurs</h2>
                <div class="cable-row" id="right-connectors">
                    <!-- Les connecteurs seront gÃ©nÃ©rÃ©s par JavaScript -->
                </div>
            </div>
        </div>
        
        <div class="message" id="message"></div>
    </div>

    <script>
        // RÃ©cupÃ©ration de l'URL de destination depuis les paramÃ¨tres
        const urlParams = new URLSearchParams(window.location.search);
        const destination = urlParams.get('d') || 'about:blank';
        
        // Configuration du jeu
        const colors = ['red', 'blue', 'green', 'yellow', 'purple', 'orange'];
        let connectedPairs = 0;
        let totalPairs = colors.length;
        
        // Ã‰lÃ©ments du DOM
        const leftCables = document.getElementById('left-cables');
        const rightConnectors = document.getElementById('right-connectors');
        const messageEl = document.getElementById('message');
        
        // Ã‰tat du jeu
        let cables = [];
        let activeCable = null;
        let cableLines = [];
        let startX, startY;
        
        // Initialisation du jeu
        function initGame() {
            connectedPairs = 0;
            cables = [];
            cableLines = [];
            leftCables.innerHTML = '';
            rightConnectors.innerHTML = '';
            messageEl.className = 'message';
            
            // MÃ©langer les couleurs
            const shuffledColors = [...colors].sort(() => Math.random() - 0.5);
            const shuffledConnectors = [...colors].sort(() => Math.random() - 0.5);
            
            // CrÃ©er les cÃ¢bles
            shuffledColors.forEach((color, index) => {
                const cable = document.createElement('div');
                cable.className = `cable ${color}`;
                cable.dataset.color = color;
                cable.dataset.id = index;
                
                // Ã‰vÃ©nements tactiles
                cable.addEventListener('touchstart', handleTouchStart);
                cable.addEventListener('touchmove', handleTouchMove);
                cable.addEventListener('touchend', handleTouchEnd);
                
                const socket = document.createElement('div');
                socket.className = 'cable-socket';
                socket.appendChild(cable);
                leftCables.appendChild(socket);
                
                cables.push(cable);
            });
            
            // CrÃ©er les connecteurs
            shuffledConnectors.forEach((color, index) => {
                const connector = document.createElement('div');
                connector.className = 'cable-socket';
                connector.dataset.color = color;
                connector.dataset.id = index;
                
                // Indicateur de couleur
                const indicator = document.createElement('div');
                indicator.className = `cable ${color}`;
                indicator.style.cursor = 'default';
                connector.appendChild(indicator);
                
                rightConnectors.appendChild(connector);
            });
        }
        
        // Gestion des Ã©vÃ©nements tactiles
        function handleTouchStart(e) {
            e.preventDefault();
            const touch = e.touches[0];
            activeCable = this;
            startX = touch.clientX;
            startY = touch.clientY;
            
            // CrÃ©er une copie pour le drag
            const rect = this.getBoundingClientRect();
            const clone = this.cloneNode(true);
            clone.style.position = 'fixed';
            clone.style.left = `${rect.left}px`;
            clone.style.top = `${rect.top}px`;
            clone.style.zIndex = '1000';
            clone.style.transform = 'scale(1.2)';
            clone.id = 'dragging-cable';
            document.body.appendChild(clone);
            
            activeCable.style.opacity = '0.5';
        }
        
        function handleTouchMove(e) {
            if (!activeCable) return;
            e.preventDefault();
            const touch = e.touches[0];
            const clone = document.getElementById('dragging-cable');
            if (clone) {
                clone.style.left = `${touch.clientX - 15}px`;
                clone.style.top = `${touch.clientY - 15}px`;
            }
        }
        
        function handleTouchEnd(e) {
            if (!activeCable) return;
            
            const clone = document.getElementById('dragging-cable');
            if (clone) {
                clone.remove();
            }
            
            const touch = e.changedTouches[0];
            const elements = document.elementsFromPoint(touch.clientX, touch.clientY);
            const connector = elements.find(el => el.classList.contains('cable-socket') && el.parentElement === rightConnectors);
            
            if (connector && activeCable.dataset.color === connector.dataset.color) {
                // Connexion rÃ©ussie
                createCableLine(activeCable, connector);
                activeCable.style.opacity = '1';
                activeCable.style.pointerEvents = 'none';
                
                connectedPairs++;
                
                if (connectedPairs === totalPairs) {
                    messageEl.textContent = 'âœ… CÃ¢bles connectÃ©s! Redirection...';
                    messageEl.className = 'message success';
                    setTimeout(() => {
                        window.location.href = destination;
                    }, 1500);
                }
            } else {
                // Erreur - recommencer
                messageEl.textContent = 'âŒ Mauvaise couleur! Recommencez...';
                messageEl.className = 'message error';
                activeCable.style.opacity = '1';
                
                setTimeout(() => {
                    messageEl.className = 'message';
                    initGame();
                }, 1500);
            }
            
            activeCable = null;
        }
        
        function createCableLine(cable, connector) {
            const line = document.createElement('div');
            line.className = 'cable-line';
            line.style.backgroundColor = cable.dataset.color;
            
            const cableRect = cable.getBoundingClientRect();
            const connectorRect = connector.getBoundingClientRect();
            const containerRect = document.querySelector('.container').getBoundingClientRect();
            
            const startX = cableRect.left + cableRect.width/2 - containerRect.left;
            const startY = cableRect.top + cableRect.height/2 - containerRect.top;
            const endX = connectorRect.left + connectorRect.width/2 - containerRect.left;
            const endY = connectorRect.top + connectorRect.height/2 - containerRect.top;
            
            const length = Math.sqrt(Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2));
            const angle = Math.atan2(endY - startY, endX - startX) * 180 / Math.PI;
            
            line.style.width = `${length}px`;
            line.style.left = `${startX}px`;
            line.style.top = `${startY}px`;
            line.style.transform = `rotate(${angle}deg)`;
            
            document.querySelector('.container').appendChild(line);
            cableLines.push(line);
        }
        
        // DÃ©marrer le jeu
        initGame();
    </script>
</body>
</html>
